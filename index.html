<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Viewer Pro</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìù</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        body { background-color: #2D2D2D; margin: 0; font-family: sans-serif; }
        header { 
            background: #24292e; color: white; padding: 10px 20px; 
            display: flex; gap: 10px; align-items: center;
            position: sticky; top: 0; z-index: 100;
        }
        #fileName { color: #ffffff; font-weight: bold; margin-left: auto; font-size: 0.85em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; }
        .container { max-width: 900px; margin: 30px auto; background: black; padding: 45px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.5); }
        .markdown-body { background-color: black !important; color: #e6edf3 !important; }

        button, input[type="file"], #searchInput { padding: 8px 12px; border-radius: 5px; border: none; font-weight: bold; }
        button { background: #2ea44f; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        button:hover { background: #2c974b; }
        #fileInput { background: #0366d6; color: white; cursor: pointer; }
        
        /* Estilo Pesquisa e Setas */
        .search-container { display: flex; gap: 5px; align-items: center; background: #3f4448; border-radius: 5px; padding-right: 5px; }
        #searchInput { background: transparent; color: white; width: 180px; font-weight: normal; outline: none; }
        .nav-btn { background: #57606a; padding: 5px 8px; font-size: 12px; min-width: 30px; }
        .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        #searchCount { font-size: 11px; color: #8b949e; min-width: 40px; text-align: center; }

        mark.search-highlight { background-color: #ffdf5d !important; color: black !important; border-radius: 2px; }
        mark.current-highlight { background-color: #f39c12 !important; outline: 2px solid white; }

        .code-wrapper { position: relative; }
        .copy-btn { position: absolute; right: 10px; top: 10px; padding: 4px 8px; font-size: 12px; background: #444; color: white; border: 1px solid #666; border-radius: 4px; opacity: 0.7; z-index: 10; }
        #scrollTopBtn {
            position: fixed;
            right: 20px;
            bottom: 20px;
            width: 46px;
            height: 46px;
            border-radius: 999px;
            background: #2ea44f;
            border: none;
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.35);
            z-index: 200;
        }
        #scrollTopBtn:hover { background: #2c974b; }
        #scrollTopBtn svg { width: 22px; height: 22px; fill: currentColor; }

        @media print { header { display: none; } .container { box-shadow: none; margin: 0; width: 100%; max-width: none; } }
    </style>
</head>
<body>

<header>
    <input type="file" id="fileInput" accept=".md">
    
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="üîç Pesquisar...">
        <span id="searchCount">0/0</span>
        <button class="nav-btn" onclick="navigateSearch(-1)" title="Anterior">‚ñ≤</button>
        <button class="nav-btn" onclick="navigateSearch(1)" title="Pr√≥ximo">‚ñº</button>
    </div>

    <button onclick="window.print()">PDF</button>
    <span id="fileName"></span>
</header>

<div class="container">
    <article id="content" class="markdown-body">
        <h1 style="color: #ccc; text-align: center;">Selecione um arquivo .md</h1>
    </article>
</div>

<button id="scrollTopBtn" type="button" title="Voltar ao topo" aria-label="Voltar ao topo">
    <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M12 6.5a1 1 0 0 1 .7.29l6 6a1 1 0 1 1-1.4 1.42L12 8.9l-5.3 5.3a1 1 0 1 1-1.4-1.42l6-6a1 1 0 0 1 .7-.29z"></path>
    </svg>
</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>

<script>
    let originalHTML = ""; 
    let matches = [];
    let currentIndex = -1;
    const scrollTopBtn = document.getElementById('scrollTopBtn');

    window.addEventListener('scroll', () => {
        scrollTopBtn.style.display = window.scrollY > 220 ? 'flex' : 'none';
    });

    scrollTopBtn.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    document.getElementById('fileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        document.getElementById('fileName').textContent = file.name;
        const reader = new FileReader();
        reader.onload = function(e) {
            originalHTML = marked.parse(e.target.result);
            document.getElementById('content').innerHTML = originalHTML;
            resetSearch();
            renderExtras();
        };
        reader.readAsText(file);
    });

    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('keydown', (e) => { 
        if (e.key === 'Enter') executeSearch(searchInput.value); 
    });

    function resetSearch() {
        matches = [];
        currentIndex = -1;
        document.getElementById('searchCount').textContent = "0/0";
    }

    function executeSearch(term) {
        const content = document.getElementById('content');
        term = term.trim();
        content.innerHTML = originalHTML;
        resetSearch();

        if (!term) { renderExtras(); return; }

        const innerSearch = (node) => {
            if (node.nodeType === 3) {
                const text = node.nodeValue;
                const re = new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, "gi");
                if (re.test(text)) {
                    const span = document.createElement('span');
                    span.innerHTML = text.replace(re, '<mark class="search-highlight">$1</mark>');
                    node.parentNode.replaceChild(span, node);
                }
            } else if (node.nodeType === 1 && !/(style|script)/i.test(node.tagName)) {
                Array.from(node.childNodes).forEach(innerSearch);
            }
        };

        innerSearch(content);
        renderExtras();

        matches = Array.from(document.querySelectorAll('.search-highlight'));
        if (matches.length > 0) {
            currentIndex = 0;
            updateSearchUI();
        }
    }

    function navigateSearch(direction) {
        if (matches.length === 0) return;

        // Remove destaque do anterior
        if (currentIndex >= 0) matches[currentIndex].classList.remove('current-highlight');

        currentIndex += direction;
        if (currentIndex >= matches.length) currentIndex = 0;
        if (currentIndex < 0) currentIndex = matches.length - 1;

        updateSearchUI();
    }

    function updateSearchUI() {
        const countDisplay = document.getElementById('searchCount');
        countDisplay.textContent = `${currentIndex + 1}/${matches.length}`;
        
        const current = matches[currentIndex];
        current.classList.add('current-highlight');
        current.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function renderExtras() {
        const content = document.getElementById('content');
        content.querySelectorAll('pre').forEach((pre) => {
            if (pre.parentElement.className === 'code-wrapper') return;
            const wrapper = document.createElement('div');
            wrapper.className = 'code-wrapper';
            pre.parentNode.insertBefore(wrapper, pre);
            wrapper.appendChild(pre);
            const btn = document.createElement('button');
            btn.className = 'copy-btn';
            btn.textContent = 'Copy';
            btn.onclick = () => {
                navigator.clipboard.writeText(pre.innerText).then(() => {
                    btn.textContent = 'Copied!';
                    setTimeout(() => btn.textContent = 'Copy', 2000);
                });
            };
            wrapper.appendChild(btn);
        });
        Prism.highlightAll();
    }
</script>
</body>
</html>
